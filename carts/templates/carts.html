{% load static %}
{% load cart %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Food Menu | Healthy and tasty food!</title>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">

  <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body style>
  <nav class="navbar navbar-dark bg-primary">
    <div class="container">
      <a class="navbar-brand" href="/">Menu</a>
      {% get_current_cart session=request.session as current_cart %}
      <a class="Cart my-2 my-lg-0" href="{{ current_cart.get_absolute_url }}">
        <div class="cart">
          <img class="cart__img" src="{% static 'img/cart.png' %}" alt="">
          <div class="cart__info">
            <div class="cart__name">{{ current_cart.name }}</div>
            <div class="cart__Count">
              Items count:
              <span class="cart__count">{{ current_cart.count }}</span>
              ($<span class="cart__sum">{{ current_cart.summary }}</span>)
            </div>
          </div>

        </div>
      </a>
    </div>
  </nav>

  <div class="container">
    <div class="row no-gutters">
      <div class="col-2" style="margin-top: 30px">
        <div class="list-group">
          {% url 'carts:list' as cart_list_url %}
          {% if request.path == cart_list_url %}
          <a class="list-group-item active" href="{{ cart_list_url }}">My carts</a>
          {% else %}
          <a class="list-group-item" href="{{ cart_list_url }}">My carts</a>
          {% endif %}
          {% url 'carts:create' as cart_create_url %}
          {% if request.path == cart_create_url %}
          <a class="list-group-item active" href="{{ cart_create_url }}">New cart</a>
          {% else %}
          <a class="list-group-item" href="{{ cart_create_url }}">New cart</a>
          {% endif %}
        </div>
      </div>

      <main class="col-10" role="main">
      {% block content %} <!-- BLOCK CONTENT -->
        <h1>My Carts</h1>
        <table id="cart" class="table table-hover table-condensed border">
          <thead>
            <tr>
              <th style="width:40%">Cart</th>
              <th style="width:10%">Items</th>
              <th style="width:15%">Total price</th>
              <th style="width:35%">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for cart in carts %}
            <tr class="product">
              <td>
                <a href="{{ cart.get_absolute_url }}">
                  <h5 class="nomargin">
                  {{ cart.name }}
                  {% if cart.id == current_cart.id %}
                    <span class="badge badge-info">current</span>
                  {% endif %}
                  </h5>
                </a>
                <p>{{ cart.description|truncatechars:100 }}</p>
              </td>
              <td data-th="Items">{{ cart.count }}</td>
              <td data-th="Total price">${{ cart.summary }}</td>
              <td class="actions">
                {% if cart.id != current_cart.id %}
                  <a href="{% url 'carts:set_current' id=cart.id %}" class="btn btn-success">Set as current</a>
                  <a href="{% url 'carts:update' id=cart.id %}" class="btn btn-primary"><img src="{% static 'img/pencil.png' %}" alt="edit"></a>
                  <a href="{% url 'carts:delete' id=cart.id %}" class="btn btn-danger"><img src="{% static 'img/trash.png' %}" alt="delete"></a>
                {% else %}
                  <button type="button" class="btn btn-secondary" disabled>Set as current</button>
                  <a href="{% url 'carts:update' id=cart.id %}" class="btn btn-primary"><img src="{% static 'img/pencil.png' %}" alt="edit"></a>
                  <button type="button" class="btn btn-secondary" disabled><img src="{% static 'img/trash.png' %}" alt="delete"></button>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endblock content %} <!-- ENDBLOCK CONTENT -->
      </main>

    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
  <script src="{% static 'js/app.js' %}"></script>
  </body>
</html>
